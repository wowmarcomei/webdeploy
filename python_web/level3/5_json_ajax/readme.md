# Json与Ajax

## Json简介

Json全名`JavaScript Object Notation`，即JS的对象符号，用于前端与后端互传数据。`javascript`为唯一的前端语言，后端语言多种多样，包括`java`,`php`,`python`等等，在前后端需要交互数据时，前后需要使用一种约定格式的数据，这种数据格式就是`json`。

## Ajax简介

Ajax全名`Asynchronous JavaScript And XML`,是一中Web开发技术，在client端创建同步web应用，它能够在**无需重新加载整个网页的情况下更新部分网页**。这显然是一种更现代化的Web技术，能够大大提高用户体验。

### [Reqwest简介](https://github.com/ded/reqwest)

`Reqwest`是一个Ajax库，用于浏览器异步HTTP请求。可以直接引用:

```html
<script src="https://cdnjs.cloudflare.com/ajax/libs/reqwest/2.0.5/reqwest.js"></script>
```

`Reqwest`的主要参数如下，


- `url` a fully qualified uri
- `method` http method (default: `GET`)
- `headers` http headers (default: `{}`)
- `data` entity body for `PATCH`, `POST` and `PUT` requests. Must be a query `String` or `JSON` object
- `type` a string enum. `html`, `xml`, `json`, or `jsonp`. Default is inferred by resource extension. Eg: `.json` will set `type` to `json`. `.xml` to `xml` etc.
- `contentType` sets the `Content-Type` of the request. Eg: `application/json`
- `crossOrigin` for cross-origin requests for browsers that support this feature.
- `success` A function called when the request successfully completes
- `error` A function called when the request fails.
- `complete` A function called whether the request is a success or failure. Always called when complete.
- `jsonpCallback` Specify the callback function name for a `JSONP` request. This value will be used instead of the random (but recommended) name automatically generated by reqwest.

如：

第一个`url`是访问的网址，第二个`type`表示类型是json,第三个参数`method`表示使用`get`方法访问该网址，`data`指定访问网址的参数，下面指定了两个参数page与format，所以最终访问的url为`https://swapi.co/api/people/?page=2&format=json`,第四个参数`success`表示访问成功的话将会返回一个对象，将读取的数据将保存在一个软参`resp`中

```html
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <script src="./js/reqwest.js"></script>
    </head>

    <body>
        <h1>Helle, there!</h1>

<script>
        // 可以在浏览器的console中打印对象a，查看结果
        var a = {}
        reqwest({
            url:"https://swapi.co/api/people/",
            type:"json",
            method:"get",
            data:{page:"2",format:"json"},
            success:function (resp) {
                a = resp
            }
        })
    </script>

    </body>
</html>

```

示例Reqwest使用：

![示例Reqwest使用](https://ws4.sinaimg.cn/large/006tKfTcly1fr0krbq54hj30u30ipdg9.jpg)

#### 实例演示

1. 在methods中加入getData函数

```js
methods:{
    modalSwitch:function () {
        this.modal.show = !this.modal.show

    },
    getData: function () {
        // 此处的this指的是Vue的实例vm
        var self = this;
        // 调用Ajax库reqwest,其实reqwest也是一个函数
        reqwest({
            url:"https://swapi.co/api/people/",
            type:"json",
            method:"get",
            data:{page:"2",format:"json"},
            success:function (resp) {
                // 在JS中函数中的函数，使用this时，往往失效，这是js的bug，为了解决这个问题，我们在上级使用self来定义
                //this.comments = resp.results;
                self.comments = resp.results;
            }
        })
    }
},
```

在`ready`函数中初始化.

```js
ready:function () {
      this.getData()
    }
```

需要注意的是上面的`reqwest`函数的`success`函数，这是函数中的函数，调用`this`会有问题，所以需要在上一级时调用，即在`getData`函数开始时就调用`this`，此时调用的`this`才是真正的Vue对象`vm`.

![](https://ws3.sinaimg.cn/large/006tKfTcgy1fr0lfbx2bij30lc0i9js9.jpg)